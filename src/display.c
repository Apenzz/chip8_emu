#include <stdbool.h>

#include <SDL3/SDL.h>

#include "display.h"

/* SDL_Window handler */
static SDL_Window *window = NULL;

/* SDL_Surface handler */
static SDL_Surface *surface = NULL;

const unsigned char fonts[80] = {
	0xf0, 0x90, 0x90, 0x90, 0xf0,	// 0
	0x20, 0x60, 0x20, 0x20, 0x70,	// 1
	0xf0, 0x10, 0xf0, 0x80, 0xf0,	// 2
	0xf0, 0x10, 0xf0, 0x10, 0xf0, 	// 3
	0x90, 0x90, 0xf0, 0x10, 0x10,	// 4
	0xf0, 0x80, 0xf0, 0x10, 0xf0,	// 5
	0xf0, 0x80, 0xf0, 0x90, 0xf0,	// 6
	0xf0, 0x10, 0x20, 0x40, 0x40,	// 7
	0xf0, 0x90, 0xf0, 0x90, 0xf0, 	// 8
	0xf0, 0x90, 0xf0, 0x10, 0xf0,	// 9
	0xf0, 0x90, 0xf0, 0x90, 0x90,	// A
	0xe0, 0x90, 0xe0, 0x90, 0xe0, 	// B
	0xf0, 0x80, 0x80, 0x80, 0xf0,	// C
	0xe0, 0x90, 0x90, 0x90, 0xe0,	// D
	0xf0, 0x80, 0xf0, 0x80, 0xf0,	// E
	0xf0, 0x80, 0xf0, 0x80, 0x80,	// F
};

/* Initialize SDL graphics library */
bool graphics_initialize(void)
{
	bool success = true;
	// initialize SDL
	if (!SDL_Init(SDL_INIT_VIDEO)) {
		SDL_Log("Could not initialize SDL library! Error: %s\n", SDL_GetError());
	success = false;
	} else {
		if (!(window = SDL_CreateWindow("Chip-8 Emulator", DISPLAY_WIDTH, DISPLAY_HEIGHT, 0))) {
			SDL_Log("Window could not be created! Error: %s\n", SDL_GetError());
			success = false;
		} else {
			// get window surface
			surface = SDL_GetWindowSurface(window);
		}
	}
	
	return success;
}

/* Cleanup and quit SDL library */
void graphics_quit(void)
{
	// Destroy surface
	SDL_DestroySurface(surface);
	
	// Destroy window
	SDL_DestroyWindow(window);

	// Quit SDL subsystems
	SDL_Quit();
}

